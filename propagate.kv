#:kivy 1.1.0
#:import Win kivy.core.window.Window
#: import FileBrowser kivy.garden.filebrowser
<MainWidget>:
    BoxLayout:
        size: Win.size
        id: mainbox
        orientation: 'vertical'
        spacing: '4dp'
        FloatLayout:
            height: '36dp'
            size_hint_y: None

            Button:
                text: 'Load File'
                size_hint_x: .35
                size_hint_y: None
                height: '36dp'
                pos_hint: {'center_x': 0.25, 'y': 0}
                on_release: root.show_load()

            Button:
                text: 'Settings (choose before load)'
                size_hint_x: .35
                size_hint_y: None
                height: '36dp'
                pos_hint: {'center_x': 0.75, 'y': 0}
                on_release: app.open_settings()

        GridLayout:
            height: '36dp'
            spacing: '8dp'
            cols: 2
            size_hint_y: None

            Label:
                id: current_slider_value
                text: '0'

            SpecSlider:
                id: position_slider
                min: -30
                max: 30
                orientation: 'horizontal'
                step: 5
                disabled: True
                on_value: current_slider_value.text = str(position_slider.value)

        FloatLayout:
            height: '36dp'
            size_hint_y: None
            ToggleButton:
                id: phase_button
                size_hint_x: .35
                pos_hint: {'center_x': 0.25, 'top': 1}
                text: 'Phase'
                group: 'display'
                disabled: True
                on_release: amplitude_button.state = 'normal' if phase_button.state == 'down' else 'down'
            ToggleButton:
                id: amplitude_button
                size_hint_x: .35
                pos_hint: {'center_x': 0.75, 'top': 1}
                text: 'Amplitude'
                group: 'display'
                state: 'down'
                disabled: True
                on_release: phase_button.state = 'down' if amplitude_button.state == 'normal' else 'normal'
                on_state: root.update_image(position_slider.value, amplitude_button.state)

        Image:
            id: imshow_image
            source: 'blank.png'

<LoadDialog>:
    BoxLayout:
        size: root.size
        pos: root.pos
        orientation: "vertical"
		FileBrowser:
			select_string: 'Select'
			on_submit: root.load(self.selection[0])
			on_canceled: root.cancel()
			on_success: root.load(self.selection[0])

<PopupBox>:
    id: loading_popup
    title: 'Calculating'
    size_hint: (None, None)
    size: Win.width / 2, Win.height / 2
    auto_dismiss: False
    BoxLayout:
        orientation: 'vertical'
        Label:
            id: loading_label
            text: '0%'
        ProgressBar:
            id: loading_progress
            max: 13
            height: 40
            on_value: loading_label.text = '{:.2f}%'.format(loading_progress.value / loading_progress.max * 100)

<SelectMatVariable>:
    title: 'Select Variable'
    auto_dismiss: False
    size_hint: .8, .6
    BoxLayout:
        orientation: 'vertical'
        spacing: 3*self.height/4
        Spinner:
            id: mat_spinner
            size_hint: None, None
            pos_hint: {'center_x': 0.5}
            height: '36dp'
            width: '128dp'
            text: root.values[0]
            values: root.values
            sync_height: True
        Button:
            text: 'Ok'
            height: '36dp'
            width: '128dp'
            pos_hint: {'center_x': 0.5}
            size_hint: None, None
            on_release: root.dismiss()

<WrongFileDialog>:
    title: 'Wrong File'
    size_hint: 1.0, 0.6
    auto_dismiss: False
    BoxLayout:
        orientation: 'vertical'
        Label:
            text: 'Unsupported file type. Supported file types are: matlab mat files and image files. Please choose again.'
        Button:
            text: 'Ok'
            size_hint: None, None
            height: '36dp'
            width: '128dp'
            pos_hint: {'center_x': 0.5}
            on_release: root.reload()